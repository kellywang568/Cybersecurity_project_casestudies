# Code that cleans the exploit-db data and prepares it to be used to create
# a column in the CVE data.
library(jsonlite)
library(tidyverse)
library(readr)

########### Part 2:
# Load the CVE data
cve_data <- readRDS('rawdata/cve.with.desc.ref.conf.rds')

# Load the exploit-db.com data
exploit_db_data <- read.csv('rawdata/files_exploits from exploit-db.csv')

#exploring structure
str(exploit_db_data)

# Extract the 'codes' column as a character vector
codes_column <- as.character(exploit_db_data$codes)
codes_vector <- unlist(strsplit(codes_column, ";"))

# Remove empty strings
codes_vector <- codes_vector[codes_vector != ""]

# So the point here is to have a list of the codes that are each separated by a 
# semicolon

# now the intention is to check each of these codes within code vector with the   
# values in cve.rds ids

# Load the cve.rds file as the original d6 file from before
d6 <- readRDS('rawdata/cve.rds')

# Check for matching items between 'codes_vector' and 'd6'
matching_items <- codes_vector[codes_vector %in% d6$id]
num_matching_items <- length(matching_items)  #3860

# Print the number of matching items
cat("Number of matching items:", num_matching_items, "\n")
############ dataframe of number of matching ID's #############

# Create a vector of unique CVE IDs from 'codes_vector'
unique_codes_vector <- unique(codes_vector)

# Find the number of matching IDs in 'd6'
matching_counts <- sapply(unique_codes_vector, function(id) sum(d6$id == id))

# Create a dataframe with columns 'CVE' and 'MatchCount'
match_df <- data.frame(CVE = unique_codes_vector, MatchCount = matching_counts)

# Now 'match_df' contains the matching counts


### In all transparency, my computer started experiencing freezing here but from 
### here what I would do is then take this dataframe and append it to the d6
### or I would run a for loop to check the vector and create a new column in the 
### d6 dataframe  and add a YES or NO to see if the exploited ID matches the 
### ID in the d6 dataframe 
